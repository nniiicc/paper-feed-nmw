!function(){"use strict";class t{constructor(t){this.module=t}debug(t,e){console.debug(`[${this.module}] ${t}`,void 0!==e?e:"")}info(t,e){console.info(`[${this.module}] ${t}`,void 0!==e?e:"")}warning(t,e){console.warn(`[${this.module}] ${t}`,void 0!==e?e:"")}warn(t,e){this.warning(t,e)}error(t,e){console.error(`[${this.module}] ${t}`,void 0!==e?e:"")}}const e=new class{getLogger(e){return new t(e)}},r=e.getLogger("link-processor");const n=e.getLogger("metadata-extractor"),a="pdf",o="url";class i{constructor(t){this.document=t,this.url=t.location.href,n.debug("Initialized metadata extractor for:",this.url)}getMetaContent(t){const e=this.document.querySelector(t);return e&&e.getAttribute("content")||""}extract(){n.debug("Extracting metadata from page:",this.url);const t={title:this.extractTitle(),authors:this.extractAuthors(),description:this.extractDescription(),publishedDate:this.extractPublishedDate(),doi:this.extractDoi(),journalName:this.extractJournalName(),tags:this.extractTags(),url:this.url};return n.debug("Metadata extraction complete:",t),t}extractTitle(){const t=this.getMetaContent('meta[name="DC.Title"]')||this.getMetaContent('meta[name="dc.title"]')||this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||this.getMetaContent('meta[name="title"]');if(t)return t;const e=["h1.title","h1.article-title","h1.paper-title","h1.document-title",".title h1",".article-title h1",".paper-title h1",'h1[itemprop="headline"]','h1[itemprop="name"]',".citation_title",".paper-title",".article-title","article h1","main h1",".content h1","#content h1",".page-title","#title","h1"];for(const t of e){const e=this.document.querySelector(t);if(e){const t=e.textContent?.trim();if(t&&t.length>5&&t.length<500)return t}}return this.document.title}extractAuthors(){const t=[];this.document.querySelectorAll('meta[name="citation_author"]').forEach(e=>{const r=e.getAttribute("content");r&&t.push(r)});const e=[];this.document.querySelectorAll('meta[name="DC.Creator.PersonalName"]').forEach(t=>{const r=t.getAttribute("content");r&&e.push(r)});const r=this.getMetaContent('meta[name="DC.Creator.PersonalName"]')||this.getMetaContent('meta[name="dc.creator.personalname"]'),n=this.getMetaContent('meta[name="citation_author"]'),a=this.getMetaContent('meta[property="og:article:author"]')||this.getMetaContent('meta[name="author"]');if(e.length>0)return e.join(", ");if(t.length>0)return t.join(", ");if(r)return r;if(n)return n;if(a)return a;const o=[".authors a",".author a",".author-name a",".authors",".author",".author-name",".author-list",'[itemprop="author"]','[rel="author"]',".byline",".by-line",".article-author",".paper-author",".contributor",".contributors",".authors",".authors-list",".authors-info .author span",".author-info",".c-article-author-list",".article-authors",".meta-authors","#authors",".author-block"];for(const t of o){const e=this.document.querySelectorAll(t);if(e.length>0){const t=[];if(e.forEach(e=>{const r=e.textContent?.trim();if(r&&r.length>1&&r.length<200){const e=r.replace(/^(by|authors?:?|written by)\s*/i,"").replace(/\s+/g," ").trim();e&&t.push(e)}}),t.length>0){const e=t.join(", ");if(e.length>2)return e}}}return""}extractDescription(){const t=this.getMetaContent('meta[name="DC.Description"]')||this.getMetaContent('meta[name="dc.description"]')||this.getMetaContent('meta[name="citation_abstract"]')||this.getMetaContent('meta[property="og:description"]')||this.getMetaContent('meta[name="description"]');if(t&&t.length>50)return t;const e=[".abstract","#abstract",'[id*="abstract"]','[class*="abstract"]',".Abstract","#Abstract",".abstractSection",".abstract-content",".abstract-text",".paper-abstract",".article-abstract","blockquote.abstract",".summary","#summary",".article-summary",".abstract-text",".abstractInFull",".c-article-section__content",'[data-component="article-abstract"]','[itemprop="description"]','[itemprop="abstract"]'];for(const t of e){const e=this.document.querySelector(t);if(e){let t=e.textContent?.trim()||"";if(t=t.replace(/^(abstract:?|summary:?)\s*/i,"").replace(/\s+/g," ").trim(),t.length>100)return t}}return t||""}extractPublishedDate(){const t=this.getMetaContent('meta[name="DC.Date.issued"]')||this.getMetaContent('meta[name="dc.date.issued"]')||this.getMetaContent('meta[name="dc.date"]')||this.getMetaContent('meta[name="dc.Date"]')||this.getMetaContent('meta[name="DC.Date"]')||this.getMetaContent('meta[name="citation_date"]')||this.getMetaContent('meta[name="citation_publication_date"]')||this.getMetaContent('meta[name="citation_online_date"]')||this.getMetaContent('meta[property="article:published_time"]')||this.getMetaContent('meta[property="article:modified_time"]');if(t)return t;const e=[".date",".pub-date",".publication-date",".published-date",".article-date",".paper-date",".dateline",'[itemprop="datePublished"]','[itemprop="dateCreated"]',"time[datetime]","time[pubdate]",".dateline",".submission-history",".meta-date",".entry-date",".post-date"];for(const t of e){const e=this.document.querySelector(t);if(e){const t=e.getAttribute("datetime")||e.getAttribute("content");if(t)return t;const r=e.textContent?.trim();if(r&&this.looksLikeDate(r))return r}}return""}looksLikeDate(t){return[/\d{4}-\d{2}-\d{2}/,/\d{1,2}\/\d{1,2}\/\d{2,4}/,/\d{1,2}\s+(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)/i,/(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s+\d{1,2}/i,/(January|February|March|April|May|June|July|August|September|October|November|December)/i,/\d{4}/].some(e=>e.test(t))}extractDoi(){const t=this.getMetaContent('meta[name="DC.Identifier.DOI"]')||this.getMetaContent('meta[name="dc.identifier.doi"]')||this.getMetaContent('meta[name="citation_doi"]')||this.getMetaContent('meta[name="DOI"]')||this.getMetaContent('meta[name="doi"]');if(t)return t;const e=this.extractDoiFromUrl(this.url);if(e)return e;const r=['a[href*="doi.org/10."]','a[href*="/doi/10."]',".doi","#doi",'[class*="doi"]'];for(const t of r){const e=this.document.querySelector(t);if(e){const t=e.getAttribute("href");if(t){const e=this.extractDoiFromUrl(t);if(e)return e}const r=e.textContent?.trim();if(r){const t=r.match(/10\.\d{4,}\/[^\s]+/);if(t)return t[0]}}}return""}extractDoiFromUrl(t){const e=[/doi\.org\/(10\.\d{4,}\/[^\s?#]+)/i,/\/doi\/(?:abs|full|pdf|epdf)?\/?((10\.\d{4,}\/[^\s?#]+))/i,/doi[=:](10\.\d{4,}\/[^\s&?#]+)/i];for(const r of e){const e=t.match(r);if(e)return e[1]||e[2]}return""}extractJournalName(){return this.getMetaContent('meta[name="DC.Source"]')||this.getMetaContent('meta[name="dc.source"]')||this.getMetaContent('meta[name="citation_journal_title"]')}extractTags(){const t=this.getMetaContent('meta[name="keywords"]')||this.getMetaContent('meta[name="DC.Subject"]')||this.getMetaContent('meta[name="dc.subject"]');return t?t.split(",").map(t=>t.trim()):[]}isPdf(){return this.url.toLowerCase().endsWith(".pdf")}getSourceType(){return this.isPdf()?a:o}generatePaperId(){return s(this.url)}}function s(t){let e=0;for(let r=0;r<t.length;r++){e=(e<<5)-e+t.charCodeAt(r),e&=e}return Math.abs(e).toString(16).toUpperCase().substring(0,8)}const c=e.getLogger("base-source");class l{constructor(){this.id="url",this.name="Web Page",this.urlPatterns=[/^https?:\/\/(?!.*\.pdf($|\?|#)).*$/i],this.contentScriptMatches=[]}canHandleUrl(t){return this.urlPatterns.some(e=>e.test(t))}extractPaperId(t){return s(t)}createMetadataExtractor(t){return function(t){return new i(t)}(t)}async extractMetadata(t,e){try{c.debug(`Extracting metadata using base extractor for ID: ${e}`);const r=this.createMetadataExtractor(t),n=r.extract(),a=t.location.href,o=r.getSourceType();return{sourceId:this.id,paperId:e,url:a,title:n.title||t.title||e,authors:n.authors||"",abstract:n.description||"",timestamp:(new Date).toISOString(),rating:"novote",publishedDate:n.publishedDate||"",tags:n.tags||[],doi:n.doi,journalName:n.journalName,sourceType:o}}catch(t){return c.error("Error extracting metadata with base extractor",t),null}}formatPaperId(t){return`${this.id}.${t}`}parsePaperId(t){const e=`${this.id}.`;if(t.startsWith(e))return t.substring(e.length);const r=`${this.id}:`;return t.startsWith(r)?(c.debug(`Parsed legacy format identifier: ${t}`),t.substring(r.length)):null}formatObjectId(t,e){return`${t}:${this.formatPaperId(e)}`}}const u=e.getLogger("arxiv-integration");class d extends i{constructor(t,e){super(t),this.apiMetadata=e}extractTitle(){return this.apiMetadata?.title?this.apiMetadata.title:super.extractTitle()}extractAuthors(){if(this.apiMetadata?.authors)return this.apiMetadata.authors;const t=this.document.querySelectorAll(".authors a");return t.length>0?Array.from(t).map(t=>t.textContent?.trim()).filter(Boolean).join(", "):super.extractAuthors()}extractDescription(){if(this.apiMetadata?.description)return this.apiMetadata.description;const t=this.document.querySelector(".abstract")?.textContent?.trim();return t?t.replace(/^Abstract:\s*/i,""):super.extractDescription()}extractPublishedDate(){if(this.apiMetadata?.publishedDate)return this.apiMetadata.publishedDate;const t=this.document.querySelector(".dateline");if(t){const e=t.textContent,r=e?.match(/\(Submitted on ([^)]+)\)/);if(r)return r[1]}return super.extractPublishedDate()}extractDoi(){return this.apiMetadata?.doi||super.extractDoi()}extractJournalName(){return this.apiMetadata?.journalName||super.extractJournalName()}extractTags(){if(this.apiMetadata?.tags)return this.apiMetadata.tags;const t=this.document.querySelector(".subjects")?.textContent?.trim();return t?t.split(/[;,]/).map(t=>t.trim()).filter(Boolean):super.extractTags()}}const p=new class extends l{constructor(){super(...arguments),this.id="arxiv",this.name="arXiv.org",this.urlPatterns=[/arxiv\.org\/(abs|pdf|html)\/([0-9.]+)/,/arxiv\.org\/\w+\/([0-9.]+)/],this.API_BASE_URL="https://export.arxiv.org/api/query"}extractPaperId(t){for(const e of this.urlPatterns){const r=t.match(e);if(r)return r[2]||r[1]}return null}createMetadataExtractor(t){return new d(t)}async fetchFromApi(t){try{const e=`${this.API_BASE_URL}?id_list=${t}`;u.debug(`Fetching from ArXiv API: ${e}`);const r=await fetch(e);if(!r.ok)return u.error(`ArXiv API request failed with status: ${r.status}`),null;const n=await r.text(),a=new DOMParser,o=a.parseFromString(n,"text/xml").querySelector("entry");if(!o)return u.warn("No entry found in ArXiv API response"),null;const i=o.querySelector("title")?.textContent?.trim()||"",s=o.querySelector("summary")?.textContent?.trim()||"",c=o.querySelector("published")?.textContent?.trim()||"",l=o.querySelectorAll("author name"),d=Array.from(l).map(t=>t.textContent?.trim()).filter(Boolean).join(", "),p=o.querySelector("arxiv\\:doi, doi")?.textContent?.trim(),m=o.querySelector("arxiv\\:journal_ref, journal_ref")?.textContent?.trim(),h=o.querySelectorAll("category");return{title:i,authors:d,description:s,publishedDate:c,doi:p,journalName:m,tags:Array.from(h).map(t=>t.getAttribute("term")).filter(Boolean)}}catch(t){return u.error("Error fetching from ArXiv API",t),null}}async extractMetadata(t,e){try{u.info(`Extracting metadata for arXiv ID: ${e}`);const r=this.createMetadataExtractor(t),n=r.extract(),a=n.title&&n.title!==t.title,o=n.authors&&n.authors.length>0,i=n.description&&n.description.length>0;if(a&&o&&i)return u.debug("Successfully extracted complete metadata from page"),this.convertToPageMetadata(n,e,r.getSourceType());u.info("Page metadata incomplete, fetching from ArXiv API");const s=await this.fetchFromApi(e);if(!s)return u.warn("Failed to fetch metadata from ArXiv API, using partial page data"),this.convertToPageMetadata(n,e,r.getSourceType());const c=new d(t,s),l=c.extract();return u.debug("Merged metadata from page and API",l),this.convertToPageMetadata(l,e,c.getSourceType())}catch(t){return u.error("Error extracting metadata for arXiv",t),null}}convertToPageMetadata(t,e,r){return{sourceId:this.id,paperId:e,url:t.url||"",title:t.title,authors:t.authors,abstract:t.description,timestamp:(new Date).toISOString(),rating:"novote",publishedDate:t.publishedDate,tags:t.tags||[],doi:t.doi,journalName:t.journalName,sourceType:r}}},m=e.getLogger("openreview-integration");class h extends i{extract(){const t=super.extract();try{const e=this.document.querySelector(".citation_title")?.textContent||this.document.querySelector(".forum-title h2")?.textContent,r=Array.from(this.document.querySelectorAll(".forum-authors a")).map(t=>t.textContent).filter(Boolean).join(", "),n=this.document.querySelector('meta[name="citation_abstract"]')?.getAttribute("content")||Array.from(this.document.querySelectorAll(".note-content-field")).find(t=>t.textContent?.includes("Abstract"))?.nextElementSibling?.textContent,a=this.document.querySelector(".date.item")?.textContent;let o="";if(a){const t=a.match(/Published: ([^,]+)/);t&&(o=t[1])}const i=this.document.querySelector('meta[name="citation_doi"]')?.getAttribute("content")||"",s=this.document.querySelectorAll(".forum-meta .item");let c="";for(let t=0;t<s.length;t++){const e=s[t];if(e.querySelector(".glyphicon-folder-open")){c=e.textContent?.trim()||"";break}}const l=Array.from(this.document.querySelectorAll(".note-content-field")).find(t=>t.textContent?.includes("Keywords"));let u=[];if(l){const t=l.nextElementSibling?.textContent;t&&(u=t.split(",").map(t=>t.trim()))}return{title:e||t.title,authors:r||t.authors,description:n||t.description,publishedDate:o||t.publishedDate,doi:i||t.doi,journalName:c||t.journalName,tags:u.length?u:t.tags,url:this.url}}catch(e){return m.error("Error during OpenReview-specific extraction",e),t}}}const g=new class extends l{constructor(){super(...arguments),this.id="openreview",this.name="OpenReview",this.urlPatterns=[/openreview\.net\/forum\?id=([a-zA-Z0-9_-]+)/,/openreview\.net\/pdf\?id=([a-zA-Z0-9_-]+)/,/openreview\.net\/attachment\?id=([a-zA-Z0-9_-]+)/,/openreview\.net\/references\?referent=([a-zA-Z0-9_-]+)/,/openreview\.net\/revisions\?id=([a-zA-Z0-9_-]+)/,/openreview\.net\/group\?id=([^&\s]+)/,/openreview\.net\/(?:forum|pdf)\?id=/]}canHandleUrl(t){return/openreview\.net\/(forum|pdf|attachment|references|revisions)\?id=/.test(t)}extractPaperId(t){const e=t.match(/[?&]id=([a-zA-Z0-9_-]+)/);if(e)return e[1];const r=t.match(/[?&]referent=([a-zA-Z0-9_-]+)/);return r?r[1]:null}createMetadataExtractor(t){return new h(t)}async extractMetadata(t,e){m.info(`Extracting metadata for OpenReview ID: ${e}`);const r=await super.extractMetadata(t,e);return r&&(m.debug("Extracted metadata from OpenReview page"),t.location.href.includes("/pdf?id=")&&(r.sourceType="pdf")),r}};e.getLogger("nature-integration");class x extends i{extractTitle(){return this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||super.extractTitle()}extractAuthors(){const t=this.getMetaContent('meta[name="citation_author"]');if(t)return t;const e=this.document.querySelectorAll(".c-article-author-list__item");return e.length>0?Array.from(e).map(t=>t.textContent?.trim()).filter(Boolean).join(", "):super.extractAuthors()}extractTags(){const t=this.getMetaContent('meta[name="dc.subject"]');return t?t.split(",").map(t=>t.trim()):[]}extractDescription(){return this.getMetaContent('meta[name="description"]')||this.getMetaContent('meta[property="og:description"]')||super.extractDescription()}extractPublishedDate(){return this.getMetaContent('meta[name="citation_publication_date"]')||super.extractPublishedDate()}extractDoi(){return this.getMetaContent('meta[name="citation_doi"]')||super.extractDoi()}}const f=new class extends l{constructor(){super(...arguments),this.id="nature",this.name="Nature",this.urlPatterns=[/nature\.com\/articles\/([^?#/]+)/,/nature\.com\/\w+\/articles\/([^?#/]+)/,/nature\.com\/srep\/articles\/([^?#/]+)/,/nature\.com\/ncomms\/articles\/([^?#/]+)/,/nature\.com\/n[a-z]+\/articles\/([^?#/]+)/,/nature\.com\/doi\/(10\.\d+\/[^?#\s]+)/,/nature\.com\/articles\/([^?#/]+)\.pdf/,/nature\.com\/articles\/([^?#/]+)\/full/]}canHandleUrl(t){return/nature\.com\/(articles|doi)\//.test(t)||/nature\.com\/\w+\/articles\//.test(t)}extractPaperId(t){const e=t.match(/nature\.com\/(?:\w+\/)?articles\/([^?#/]+)/);if(e)return e[1].replace(/\.pdf$/,"");const r=t.match(/nature\.com\/doi\/(10\.\d+\/[^?#\s]+)/);return r?r[1]:null}createMetadataExtractor(t){return new x(t)}};const b=new class extends l{constructor(){super(...arguments),this.id="pnas",this.name="PNAS",this.urlPatterns=[/pnas\.org\/doi\/(10\.1073\/pnas\.[0-9]+)/,/pnas\.org\/doi\/abs\/(10\.1073\/pnas\.[0-9]+)/,/pnas\.org\/doi\/full\/(10\.1073\/pnas\.[0-9]+)/,/pnas\.org\/doi\/pdf\/(10\.1073\/pnas\.[0-9]+)/,/pnas\.org\/doi\/epdf\/(10\.1073\/pnas\.[0-9]+)/,/pnas\.org\/doi\/(10\.1073\/[^\s?#]+)/,/pnas\.org\/content\/(\d+\/\d+\/[^\s?#]+)/,/pnas\.org\/content\/early\/\d+\/\d+\/\d+\/(\d+)/,/pnas\.org\/cgi\/doi\/(10\.1073\/[^\s?#]+)/,/pnas\.org\/doi\//]}canHandleUrl(t){return/pnas\.org\/(doi|content|cgi)\//.test(t)}extractPaperId(t){const e=t.match(/pnas\.org\/(?:doi\/(?:abs|full|pdf|epdf)?\/?)?(10\.1073\/[^\s?#]+)/);if(e)return e[1];const r=t.match(/content\/(\d+\/\d+\/[^\s?#.]+)/);if(r)return r[1];const n=t.match(/early\/\d+\/\d+\/\d+\/(\d+)/);return n?n[1]:null}};e.getLogger("sciencedirect-integration");class y extends i{extractTitle(){return this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||super.extractTitle()}extractAuthors(){const t=[];return this.document.querySelectorAll('meta[name="citation_author"]').forEach(e=>{const r=e.getAttribute("content");r&&t.push(r)}),t.length>0?t.join(", "):super.extractAuthors()}extractDescription(){return this.getMetaContent('meta[name="description"]')||this.getMetaContent('meta[property="og:description"]')||super.extractDescription()}extractPublishedDate(){return this.getMetaContent('meta[name="citation_publication_date"]')||this.getMetaContent('meta[name="citation_online_date"]')||super.extractPublishedDate()}extractDoi(){return this.getMetaContent('meta[name="citation_doi"]')||super.extractDoi()}extractJournalName(){return this.getMetaContent('meta[name="citation_journal_title"]')||super.extractJournalName()}extractTags(){const t=this.getMetaContent('meta[name="citation_keywords"]')||this.getMetaContent('meta[name="keywords"]');return t?t.split(/[;,]/).map(t=>t.trim()).filter(Boolean):super.extractTags()}}const M=new class extends l{constructor(){super(...arguments),this.id="sciencedirect",this.name="ScienceDirect",this.urlPatterns=[/sciencedirect\.com\/science\/article\/pii\/([A-Z0-9]+)/i,/sciencedirect\.com\/science\/article\/abs\/pii\/([A-Z0-9]+)/i,/sciencedirect\.com\/science\/book\/([A-Z0-9]+)/i,/sciencedirect\.com\/science\/article\/doi\/(10\.\d+\/[^\s?#]+)/i,/sciencedirect\.com\/science\/article\//,/sciencedirect\.com\/\S+\.pdf/i,/reader\.elsevier\.com\/reader\/sd\/pii\/([A-Z0-9]+)/i]}canHandleUrl(t){return/sciencedirect\.com\/science\/article\//.test(t)||/sciencedirect\.com\/science\/book\//.test(t)||/reader\.elsevier\.com\/reader\/sd\/pii\//.test(t)}extractPaperId(t){const e=t.match(/pii\/([A-Z0-9]+)/i);if(e)return e[1];const r=t.match(/doi\/(10\.\d+\/[^\s?#]+)/i);if(r)return r[1];const n=t.match(/book\/([A-Z0-9]+)/i);return n?n[1]:null}createMetadataExtractor(t){return new y(t)}};e.getLogger("springer-integration");class C extends i{extractTitle(){return this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||this.getMetaContent('meta[name="dc.title"]')||super.extractTitle()}extractAuthors(){const t=[];if(this.document.querySelectorAll('meta[name="citation_author"]').forEach(e=>{const r=e.getAttribute("content");r&&t.push(r)}),t.length>0)return t.join(", ");const e=[];return this.document.querySelectorAll('meta[name="dc.creator"]').forEach(t=>{const r=t.getAttribute("content");r&&e.push(r)}),e.length>0?e.join(", "):super.extractAuthors()}extractDescription(){return this.getMetaContent('meta[name="dc.description"]')||this.getMetaContent('meta[name="description"]')||this.getMetaContent('meta[property="og:description"]')||super.extractDescription()}extractPublishedDate(){return this.getMetaContent('meta[name="citation_publication_date"]')||this.getMetaContent('meta[name="citation_online_date"]')||this.getMetaContent('meta[name="dc.date"]')||super.extractPublishedDate()}extractDoi(){return this.getMetaContent('meta[name="citation_doi"]')||this.getMetaContent('meta[name="dc.identifier"]')||super.extractDoi()}extractJournalName(){return this.getMetaContent('meta[name="citation_journal_title"]')||this.getMetaContent('meta[name="citation_conference_title"]')||this.getMetaContent('meta[name="prism.publicationName"]')||super.extractJournalName()}extractTags(){const t=this.getMetaContent('meta[name="citation_keywords"]')||this.getMetaContent('meta[name="keywords"]');return t?t.split(/[;,]/).map(t=>t.trim()).filter(Boolean):super.extractTags()}}const _=new class extends l{constructor(){super(...arguments),this.id="springer",this.name="Springer",this.urlPatterns=[/link\.springer\.com\/article\/(10\.\d+\/[^\s?#]+)/,/link\.springer\.com\/chapter\/(10\.\d+\/[^\s?#]+)/,/link\.springer\.com\/book\/(10\.\d+\/[^\s?#]+)/,/link\.springer\.com\/content\/pdf\/(10\.\d+\/[^\s?#]+)/,/link\.springer\.com\/proceeding\/(10\.\d+\/[^\s?#]+)/,/link\.springer\.com\/referenceworkentry\/(10\.\d+\/[^\s?#]+)/,/link\.springer\.com\/content\/pdf\/(10\.\d+%2F[^\s?#]+)/,/link\.springer\.com\/epub\/(10\.\d+\/[^\s?#]+)/,/link\.springer\.com\/article\//,/link\.springer\.com\/chapter\//,/link\.springer\.com\/book\//]}canHandleUrl(t){return/link\.springer\.com\/(article|chapter|book|content|proceeding|referenceworkentry|epub)\//.test(t)}extractPaperId(t){const e=t.match(/link\.springer\.com\/(?:article|chapter|book|content\/pdf|proceeding|referenceworkentry|epub)\/(10\.\d+[/%][^\s?#]+)/);return e?decodeURIComponent(e[1]).replace(/%2F/gi,"/"):null}createMetadataExtractor(t){return new C(t)}};e.getLogger("ieee-integration");class w extends i{extractTitle(){return this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||super.extractTitle()}extractAuthors(){const t=[];if(this.document.querySelectorAll('meta[name="citation_author"]').forEach(e=>{const r=e.getAttribute("content");r&&t.push(r)}),t.length>0)return t.join(", ");const e=this.document.querySelectorAll(".authors-info .author span");return e.length>0?Array.from(e).map(t=>t.textContent?.trim()).filter(Boolean).join(", "):super.extractAuthors()}extractDescription(){const t=this.getMetaContent('meta[name="description"]')||this.getMetaContent('meta[property="og:description"]');if(!t){const t=this.document.querySelector(".abstract-text");if(t)return t.textContent?.trim()||""}return t||super.extractDescription()}extractPublishedDate(){return this.getMetaContent('meta[name="citation_publication_date"]')||this.getMetaContent('meta[name="citation_date"]')||this.getMetaContent('meta[name="citation_online_date"]')||super.extractPublishedDate()}extractDoi(){return this.getMetaContent('meta[name="citation_doi"]')||super.extractDoi()}extractJournalName(){return this.getMetaContent('meta[name="citation_journal_title"]')||this.getMetaContent('meta[name="citation_conference_title"]')||super.extractJournalName()}extractTags(){const t=this.getMetaContent('meta[name="citation_keywords"]')||this.getMetaContent('meta[name="keywords"]');if(t)return t.split(/[;,]/).map(t=>t.trim()).filter(Boolean);const e=this.document.querySelectorAll(".keywords .keyword");return e.length>0?Array.from(e).map(t=>t.textContent?.trim()).filter(Boolean):super.extractTags()}}const A=new class extends l{constructor(){super(...arguments),this.id="ieee",this.name="IEEE Xplore",this.urlPatterns=[/ieeexplore\.ieee\.org\/document\/(\d+)/,/ieeexplore\.ieee\.org\/abstract\/document\/(\d+)/,/ieeexplore\.ieee\.org\/stamp\/stamp\.jsp\?.*arnumber=(\d+)/,/ieeexplore\.ieee\.org\/ielx?\d*\/\d+\/\d+\/(\d+)\.pdf/,/ieeexplore\.ieee\.org\/xpl\/articleDetails\.jsp\?arnumber=(\d+)/,/ieeexplore\.ieee\.org\/xpl\/tocresult\.jsp/,/ieeexplore\.ieee\.org\/courses\/details\/(\d+)/,/computer\.org\/csdl\/\w+\/\d+\/\d+\/(\d+)/,/ieeexplore\.ieee\.org\/document\//,/ieeexplore\.ieee\.org\/abstract\/document\//]}canHandleUrl(t){return/ieeexplore\.ieee\.org\/(document|abstract|stamp|ielx?\d*|xpl)\//.test(t)||/computer\.org\/csdl\//.test(t)}extractPaperId(t){const e=t.match(/document\/(\d+)/);if(e)return e[1];const r=t.match(/arnumber=(\d+)/);if(r)return r[1];const n=t.match(/\/(\d+)\.pdf/);if(n)return n[1];const a=t.match(/csdl\/\w+\/\d+\/\d+\/(\d+)/);return a?a[1]:null}createMetadataExtractor(t){return new w(t)}};e.getLogger("acm-integration");class v extends i{extractTitle(){return this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||this.getMetaContent('meta[name="dc.Title"]')||super.extractTitle()}extractAuthors(){const t=[];return this.document.querySelectorAll('meta[name="citation_author"]').forEach(e=>{const r=e.getAttribute("content");r&&t.push(r)}),t.length>0?t.join(", "):super.extractAuthors()}extractDescription(){return this.getMetaContent('meta[name="description"]')||this.getMetaContent('meta[property="og:description"]')||super.extractDescription()}extractPublishedDate(){return this.getMetaContent('meta[name="citation_publication_date"]')||this.getMetaContent('meta[name="citation_date"]')||this.getMetaContent('meta[name="dc.Date"]')||super.extractPublishedDate()}extractDoi(){return this.getMetaContent('meta[name="citation_doi"]')||this.getMetaContent('meta[name="dc.Identifier"]')||super.extractDoi()}extractJournalName(){return this.getMetaContent('meta[name="citation_journal_title"]')||this.getMetaContent('meta[name="citation_conference_title"]')||this.getMetaContent('meta[name="dc.Source"]')||super.extractJournalName()}extractTags(){const t=this.getMetaContent('meta[name="citation_keywords"]')||this.getMetaContent('meta[name="keywords"]');return t?t.split(/[;,]/).map(t=>t.trim()).filter(Boolean):super.extractTags()}}const D=new class extends l{constructor(){super(...arguments),this.id="acm",this.name="ACM Digital Library",this.urlPatterns=[/dl\.acm\.org\/doi\/(10\.\d+\/[^\s?#]+)/,/dl\.acm\.org\/doi\/abs\/(10\.\d+\/[^\s?#]+)/,/dl\.acm\.org\/doi\/full\/(10\.\d+\/[^\s?#]+)/,/dl\.acm\.org\/doi\/pdf\/(10\.\d+\/[^\s?#]+)/,/dl\.acm\.org\/doi\/epdf\/(10\.\d+\/[^\s?#]+)/,/dl\.acm\.org\/citation\.cfm\?id=(\d+)/,/dl\.acm\.org\/citation\.cfm\?.*doid=[\d.]+\.(\d+)/,/dl\.acm\.org\/doi\/proceedings\/(10\.\d+\/[^\s?#]+)/,/dl\.acm\.org\/doi\/book\/(10\.\d+\/[^\s?#]+)/,/dl\.acm\.org\/doi\//]}canHandleUrl(t){return/dl\.acm\.org\/(doi|citation)/.test(t)}extractPaperId(t){const e=t.match(/dl\.acm\.org\/doi\/(?:abs|full|pdf|epdf|proceedings|book)?\/?((10\.\d+\/[^\s?#]+))/);if(e)return e[2]||e[1];const r=t.match(/citation\.cfm\?.*id=(\d+)/);if(r)return r[1];const n=t.match(/doid=[\d.]+\.(\d+)/);return n?n[1]:null}createMetadataExtractor(t){return new v(t)}};e.getLogger("acl-integration");class P extends i{extractTitle(){return this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||super.extractTitle()}extractAuthors(){const t=[];return this.document.querySelectorAll('meta[name="citation_author"]').forEach(e=>{const r=e.getAttribute("content");r&&t.push(r)}),t.length>0?t.join(", "):super.extractAuthors()}extractDescription(){return this.getMetaContent('meta[name="citation_abstract"]')||this.getMetaContent('meta[name="description"]')||this.getMetaContent('meta[property="og:description"]')||super.extractDescription()}extractPublishedDate(){return this.getMetaContent('meta[name="citation_publication_date"]')||this.getMetaContent('meta[name="citation_date"]')||super.extractPublishedDate()}extractDoi(){return this.getMetaContent('meta[name="citation_doi"]')||super.extractDoi()}extractJournalName(){return this.getMetaContent('meta[name="citation_conference_title"]')||this.getMetaContent('meta[name="citation_journal_title"]')||super.extractJournalName()}extractTags(){const t=this.getMetaContent('meta[name="citation_keywords"]')||this.getMetaContent('meta[name="keywords"]');return t?t.split(/[;,]/).map(t=>t.trim()).filter(Boolean):super.extractTags()}}const S=new class extends l{constructor(){super(...arguments),this.id="acl",this.name="ACL Anthology",this.urlPatterns=[/aclanthology\.org\/([A-Z0-9]+\.\d+-[a-z]+-\d+)/i,/aclanthology\.org\/([A-Z0-9]+\.\d+-\d+)/,/aclanthology\.org\/([A-Z]\d{2}-\d+)/,/aclweb\.org\/anthology\/([A-Z0-9]+\.\d+-\d+)/,/aclweb\.org\/anthology\/([A-Z]\d{2}-\d+)/,/aclanthology\.org\/([^\/]+)\.pdf/,/aclanthology\.org\/volumes\/([^\/\s?#]+)/,/aclanthology\.org\/[A-Z0-9]/i]}canHandleUrl(t){return/aclanthology\.org\/[A-Z0-9]/i.test(t)||/aclweb\.org\/anthology\//.test(t)}extractPaperId(t){const e=t.match(/aclanthology\.org\/([A-Z0-9]+\.[a-z0-9-]+)/i);if(e)return e[1].replace(/\.pdf$/,"");const r=t.match(/(?:aclanthology|aclweb)\.org\/(?:anthology\/)?([A-Z]\d{2}-\d+)/);if(r)return r[1];const n=t.match(/volumes\/([^\/\s?#]+)/);return n?n[1]:null}createMetadataExtractor(t){return new P(t)}};e.getLogger("neurips-integration");class I extends i{extractTitle(){return this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||super.extractTitle()}extractAuthors(){const t=[];if(this.document.querySelectorAll('meta[name="citation_author"]').forEach(e=>{const r=e.getAttribute("content");r&&t.push(r)}),t.length>0)return t.join(", ");const e=this.document.querySelectorAll(".author a, .author span");return e.length>0?Array.from(e).map(t=>t.textContent?.trim()).filter(Boolean).join(", "):super.extractAuthors()}extractDescription(){const t=this.getMetaContent('meta[name="citation_abstract"]')||this.getMetaContent('meta[name="description"]')||this.getMetaContent('meta[property="og:description"]');if(!t){const t=this.document.querySelector(".abstract");if(t)return t.textContent?.trim()||""}return t||super.extractDescription()}extractPublishedDate(){return this.getMetaContent('meta[name="citation_publication_date"]')||this.getMetaContent('meta[name="citation_date"]')||super.extractPublishedDate()}extractJournalName(){return this.getMetaContent('meta[name="citation_conference_title"]')||"NeurIPS"}extractTags(){const t=this.getMetaContent('meta[name="citation_keywords"]')||this.getMetaContent('meta[name="keywords"]');return t?t.split(/[;,]/).map(t=>t.trim()).filter(Boolean):super.extractTags()}}const k=new class extends l{constructor(){super(...arguments),this.id="neurips",this.name="NeurIPS",this.urlPatterns=[/proceedings\.neurips\.cc\/paper\/(\d+)\/hash\/([a-f0-9]+)/,/proceedings\.neurips\.cc\/paper\/(\d+)\/file\/([a-f0-9]+)/,/proceedings\.neurips\.cc\/paper_files\/paper\/(\d+)\/hash\/([a-f0-9]+)/,/proceedings\.neurips\.cc\/paper_files\/paper\/(\d+)\/file\/([a-f0-9]+)/,/papers\.nips\.cc\/paper\/(\d+)\/hash\/([a-f0-9]+)/,/papers\.nips\.cc\/paper\/(\d+)\/file\/([a-f0-9]+)/,/papers\.nips\.cc\/paper_files\/paper\/(\d+)\/hash\/([a-f0-9]+)/,/papers\.nips\.cc\/paper\/(\d+)-([^\/\s]+)/,/proceedings\.neurips\.cc\/paper\/(\d+)-([^\/\s]+)/,/proceedings\.neurips\.cc\/paper/,/papers\.nips\.cc\/paper/]}canHandleUrl(t){return/proceedings\.neurips\.cc\/paper/.test(t)||/papers\.nips\.cc\/paper/.test(t)}extractPaperId(t){const e=t.match(/paper(?:_files)?\/paper\/(\d+)\/(?:hash|file)\/([a-f0-9]+)/);if(e)return`${e[1]}-${e[2]}`;const r=t.match(/paper\/(\d+)-([^\/\s.]+)/);if(r)return`${r[1]}-${r[2]}`;const n=t.match(/paper(?:_files)?\/paper\/(\d+)\/([^\/\s]+)/);return n?`${n[1]}-${n[2]}`:null}createMetadataExtractor(t){return new I(t)}};e.getLogger("cvf-integration");class T extends i{extractTitle(){return this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||super.extractTitle()}extractAuthors(){const t=[];if(this.document.querySelectorAll('meta[name="citation_author"]').forEach(e=>{const r=e.getAttribute("content");r&&t.push(r)}),t.length>0)return t.join(", ");const e=this.document.querySelectorAll(".author a, #authors b");return e.length>0?Array.from(e).map(t=>t.textContent?.trim()).filter(Boolean).join(", "):super.extractAuthors()}extractDescription(){const t=this.getMetaContent('meta[name="citation_abstract"]')||this.getMetaContent('meta[name="description"]')||this.getMetaContent('meta[property="og:description"]');if(!t){const t=this.document.querySelector("#abstract");if(t)return t.textContent?.trim()||""}return t||super.extractDescription()}extractPublishedDate(){return this.getMetaContent('meta[name="citation_publication_date"]')||this.getMetaContent('meta[name="citation_date"]')||super.extractPublishedDate()}extractJournalName(){return this.getMetaContent('meta[name="citation_conference_title"]')||super.extractJournalName()}extractTags(){const t=this.getMetaContent('meta[name="citation_keywords"]')||this.getMetaContent('meta[name="keywords"]');return t?t.split(/[;,]/).map(t=>t.trim()).filter(Boolean):super.extractTags()}}const E=new class extends l{constructor(){super(...arguments),this.id="cvf",this.name="CVF Open Access",this.urlPatterns=[/openaccess\.thecvf\.com\/content[_\/]([A-Z]+)[_\/](\d+)[_\/]html[_\/]([^.]+)\.html/i,/openaccess\.thecvf\.com\/content\/([A-Z]+)(\d+)[_\/]html[_\/]([^.]+)\.html/i,/openaccess\.thecvf\.com\/content[_\/]([A-Z]+)[_\/](\d+)[_\/]papers[_\/]([^.]+)\.pdf/i,/openaccess\.thecvf\.com\/content\/([A-Z]+)(\d+)[_\/]papers[_\/]([^.]+)\.pdf/i,/openaccess\.thecvf\.com\/content[_\/]([A-Z]+)[_\/](\d+)[_\/]W\d+[_\/]html[_\/]([^.]+)\.html/i,/openaccess\.thecvf\.com\/content[_\/]([A-Z]+)[_\/](\d+)[_\/]W\d+[_\/]papers[_\/]([^.]+)\.pdf/i,/openaccess\.thecvf\.com\/content[_\/]([A-Z]+)[_\/](\d+)[_\/]supplemental[_\/]([^.]+)/i,/openaccess\.thecvf\.com\/content/]}canHandleUrl(t){return/openaccess\.thecvf\.com\/content/.test(t)}extractPaperId(t){const e=t.match(/content[_\/]([A-Z]+)[_\/](\d+)[_\/](?:W\d+[_\/])?(?:html|papers)[_\/]([^.\/]+)/i);if(e)return`${e[1]}-${e[2]}-${e[3]}`;const r=t.match(/content\/([A-Z]+)(\d{4})[_\/](?:W\d+[_\/])?(?:html|papers)[_\/]([^.\/]+)/i);if(r)return`${r[1]}-${r[2]}-${r[3]}`;const n=t.match(/\/([^\/]+)\.(?:html|pdf)$/);return n?n[1]:null}createMetadataExtractor(t){return new T(t)}};e.getLogger("wiley-integration");class j extends i{extractTitle(){return this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||this.getMetaContent('meta[name="dc.Title"]')||super.extractTitle()}extractAuthors(){const t=[];return this.document.querySelectorAll('meta[name="citation_author"]').forEach(e=>{const r=e.getAttribute("content");r&&t.push(r)}),t.length>0?t.join(", "):super.extractAuthors()}extractDescription(){return this.getMetaContent('meta[name="description"]')||this.getMetaContent('meta[property="og:description"]')||super.extractDescription()}extractPublishedDate(){return this.getMetaContent('meta[name="citation_publication_date"]')||this.getMetaContent('meta[name="citation_online_date"]')||this.getMetaContent('meta[name="dc.Date"]')||super.extractPublishedDate()}extractDoi(){return this.getMetaContent('meta[name="citation_doi"]')||this.getMetaContent('meta[name="dc.Identifier"]')||super.extractDoi()}extractJournalName(){return this.getMetaContent('meta[name="citation_journal_title"]')||this.getMetaContent('meta[name="dc.Source"]')||super.extractJournalName()}extractTags(){const t=this.getMetaContent('meta[name="citation_keywords"]')||this.getMetaContent('meta[name="keywords"]');return t?t.split(/[;,]/).map(t=>t.trim()).filter(Boolean):super.extractTags()}}const $=new class extends l{constructor(){super(...arguments),this.id="wiley",this.name="Wiley Online Library",this.urlPatterns=[/onlinelibrary\.wiley\.com\/doi\/(10\.\d+\/[^\s?#]+)/,/onlinelibrary\.wiley\.com\/doi\/abs\/(10\.\d+\/[^\s?#]+)/,/onlinelibrary\.wiley\.com\/doi\/full\/(10\.\d+\/[^\s?#]+)/,/onlinelibrary\.wiley\.com\/doi\/pdf\/(10\.\d+\/[^\s?#]+)/,/onlinelibrary\.wiley\.com\/doi\/epdf\/(10\.\d+\/[^\s?#]+)/,/\w+\.onlinelibrary\.wiley\.com\/doi\/(10\.\d+\/[^\s?#]+)/,/\w+\.onlinelibrary\.wiley\.com\/doi\/abs\/(10\.\d+\/[^\s?#]+)/,/\w+\.onlinelibrary\.wiley\.com\/doi\/full\/(10\.\d+\/[^\s?#]+)/,/agupubs\.onlinelibrary\.wiley\.com\/doi\/(10\.\d+\/[^\s?#]+)/,/febs\.onlinelibrary\.wiley\.com\/doi\/(10\.\d+\/[^\s?#]+)/,/onlinelibrary\.wiley\.com\/doi\//,/\.onlinelibrary\.wiley\.com\/doi\//]}canHandleUrl(t){return/\.?onlinelibrary\.wiley\.com\/doi\//.test(t)}extractPaperId(t){const e=t.match(/\/doi\/(?:abs|full|pdf|epdf)?\/?((10\.\d+\/[^\s?#]+))/);return e?e[2]||e[1]:null}createMetadataExtractor(t){return new j(t)}};e.getLogger("plos-integration");class N extends i{extractTitle(){return this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||this.getMetaContent('meta[name="dc.title"]')||super.extractTitle()}extractAuthors(){const t=[];return this.document.querySelectorAll('meta[name="citation_author"]').forEach(e=>{const r=e.getAttribute("content");r&&t.push(r)}),t.length>0?t.join(", "):super.extractAuthors()}extractDescription(){return this.getMetaContent('meta[name="description"]')||this.getMetaContent('meta[property="og:description"]')||super.extractDescription()}extractPublishedDate(){return this.getMetaContent('meta[name="citation_publication_date"]')||this.getMetaContent('meta[name="citation_date"]')||this.getMetaContent('meta[name="dc.date"]')||super.extractPublishedDate()}extractDoi(){return this.getMetaContent('meta[name="citation_doi"]')||this.getMetaContent('meta[name="dc.identifier"]')||super.extractDoi()}extractJournalName(){return this.getMetaContent('meta[name="citation_journal_title"]')||super.extractJournalName()}extractTags(){const t=this.getMetaContent('meta[name="citation_keywords"]')||this.getMetaContent('meta[name="keywords"]');return t?t.split(/[;,]/).map(t=>t.trim()).filter(Boolean):super.extractTags()}}const q=new class extends l{constructor(){super(...arguments),this.id="plos",this.name="PLOS",this.urlPatterns=[/journals\.plos\.org\/\w+\/article\?id=(10\.\d+\/[^\s&]+)/,/journals\.plos\.org\/\w+\/article\/info[:%]3Adoi[/%]2F(10\.\d+)/,/journals\.plos\.org\/\w+\/article/]}canHandleUrl(t){return/journals\.plos\.org\/\w+\/article/.test(t)}extractPaperId(t){const e=t.match(/[?&]id=(10\.\d+\/[^\s&]+)/);if(e)return decodeURIComponent(e[1]);const r=t.match(/doi[/%]2F(10\.\d+[/%]2F[^\s&]+)/i);return r?decodeURIComponent(r[1].replace(/%2F/gi,"/")):null}createMetadataExtractor(t){return new N(t)}};e.getLogger("biorxiv-integration");class L extends i{extractTitle(){return this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||this.getMetaContent('meta[name="DC.Title"]')||super.extractTitle()}extractAuthors(){const t=[];return this.document.querySelectorAll('meta[name="citation_author"]').forEach(e=>{const r=e.getAttribute("content");r&&t.push(r)}),t.length>0?t.join(", "):super.extractAuthors()}extractDescription(){return this.getMetaContent('meta[name="citation_abstract"]')||this.getMetaContent('meta[name="description"]')||this.getMetaContent('meta[property="og:description"]')||super.extractDescription()}extractPublishedDate(){return this.getMetaContent('meta[name="citation_publication_date"]')||this.getMetaContent('meta[name="citation_online_date"]')||this.getMetaContent('meta[name="DC.Date"]')||super.extractPublishedDate()}extractDoi(){return this.getMetaContent('meta[name="citation_doi"]')||this.getMetaContent('meta[name="DC.Identifier"]')||super.extractDoi()}extractJournalName(){return this.getMetaContent('meta[name="citation_journal_title"]')||"bioRxiv"}extractTags(){const t=this.getMetaContent('meta[name="citation_keywords"]')||this.getMetaContent('meta[name="keywords"]');return t?t.split(/[;,]/).map(t=>t.trim()).filter(Boolean):super.extractTags()}}const J=new class extends l{constructor(){super(...arguments),this.id="biorxiv",this.name="bioRxiv",this.urlPatterns=[/biorxiv\.org\/content\/(10\.\d+\/[^\s?#]+)/,/biorxiv\.org\/content\/early\/\d+\/\d+\/\d+\/(\d+)/,/biorxiv\.org\/content\/(10\.\d+\/[^\s?#]+)\.full/,/biorxiv\.org\/content\/(10\.\d+\/[^\s?#]+)\.abstract/,/biorxiv\.org\/content\/(10\.\d+\/[^\s?#]+)\.pdf/,/biorxiv\.org\/cgi\/content\/full\/(\d+)/,/biorxiv\.org\/cgi\/content\/abstract\/(\d+)/,/biorxiv\.org\/content\//]}canHandleUrl(t){return/biorxiv\.org\/(content|cgi\/content)\//.test(t)}extractPaperId(t){const e=t.match(/biorxiv\.org\/content\/(10\.\d+\/[^\s?#.]+)/);if(e)return e[1].replace(/v\d+$/,"");const r=t.match(/early\/\d+\/\d+\/\d+\/(\d+)/);if(r)return r[1];const n=t.match(/cgi\/content\/(?:full|abstract)\/(\d+)/);return n?n[1]:null}createMetadataExtractor(t){return new L(t)}};e.getLogger("medrxiv-integration");class U extends i{extractTitle(){return this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||this.getMetaContent('meta[name="DC.Title"]')||super.extractTitle()}extractAuthors(){const t=[];return this.document.querySelectorAll('meta[name="citation_author"]').forEach(e=>{const r=e.getAttribute("content");r&&t.push(r)}),t.length>0?t.join(", "):super.extractAuthors()}extractDescription(){return this.getMetaContent('meta[name="citation_abstract"]')||this.getMetaContent('meta[name="description"]')||this.getMetaContent('meta[property="og:description"]')||super.extractDescription()}extractPublishedDate(){return this.getMetaContent('meta[name="citation_publication_date"]')||this.getMetaContent('meta[name="citation_online_date"]')||this.getMetaContent('meta[name="DC.Date"]')||super.extractPublishedDate()}extractDoi(){return this.getMetaContent('meta[name="citation_doi"]')||this.getMetaContent('meta[name="DC.Identifier"]')||super.extractDoi()}extractJournalName(){return this.getMetaContent('meta[name="citation_journal_title"]')||"medRxiv"}extractTags(){const t=this.getMetaContent('meta[name="citation_keywords"]')||this.getMetaContent('meta[name="keywords"]');return t?t.split(/[;,]/).map(t=>t.trim()).filter(Boolean):super.extractTags()}}const Z=new class extends l{constructor(){super(...arguments),this.id="medrxiv",this.name="medRxiv",this.urlPatterns=[/medrxiv\.org\/content\/(10\.\d+\/[^\s?#]+)/,/medrxiv\.org\/content\/early\/\d+\/\d+\/\d+\/(\d+)/,/medrxiv\.org\/content\/(10\.\d+\/[^\s?#]+)\.full/,/medrxiv\.org\/content\/(10\.\d+\/[^\s?#]+)\.abstract/,/medrxiv\.org\/content\/(10\.\d+\/[^\s?#]+)\.pdf/,/medrxiv\.org\/cgi\/content\/full\/(\d+)/,/medrxiv\.org\/cgi\/content\/abstract\/(\d+)/,/medrxiv\.org\/content\//]}canHandleUrl(t){return/medrxiv\.org\/(content|cgi\/content)\//.test(t)}extractPaperId(t){const e=t.match(/medrxiv\.org\/content\/(10\.\d+\/[^\s?#.]+)/);if(e)return e[1].replace(/v\d+$/,"");const r=t.match(/early\/\d+\/\d+\/\d+\/(\d+)/);if(r)return r[1];const n=t.match(/cgi\/content\/(?:full|abstract)\/(\d+)/);return n?n[1]:null}createMetadataExtractor(t){return new U(t)}};e.getLogger("ssrn-integration");class B extends i{extractTitle(){return this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||super.extractTitle()}extractAuthors(){const t=[];return this.document.querySelectorAll('meta[name="citation_author"]').forEach(e=>{const r=e.getAttribute("content");r&&t.push(r)}),t.length>0?t.join(", "):super.extractAuthors()}extractDescription(){return this.getMetaContent('meta[name="description"]')||this.getMetaContent('meta[property="og:description"]')||super.extractDescription()}extractPublishedDate(){return this.getMetaContent('meta[name="citation_publication_date"]')||this.getMetaContent('meta[name="citation_date"]')||this.getMetaContent('meta[name="citation_online_date"]')||super.extractPublishedDate()}extractDoi(){return this.getMetaContent('meta[name="citation_doi"]')||super.extractDoi()}extractJournalName(){return this.getMetaContent('meta[name="citation_journal_title"]')||"SSRN"}extractTags(){const t=this.getMetaContent('meta[name="citation_keywords"]')||this.getMetaContent('meta[name="keywords"]');return t?t.split(/[;,]/).map(t=>t.trim()).filter(Boolean):super.extractTags()}}const O=new class extends l{constructor(){super(...arguments),this.id="ssrn",this.name="SSRN",this.urlPatterns=[/ssrn\.com\/abstract=(\d+)/,/papers\.ssrn\.com\/sol3\/papers\.cfm\?abstract_id=(\d+)/,/papers\.ssrn\.com\/sol3\/papers\.cfm\?.*abstract_id=(\d+)/,/papers\.ssrn\.com\/sol3\/Delivery\.cfm.*abstractid=(\d+)/i,/ssrn\.com\/(\d{7,})/,/dx\.doi\.org\/10\.2139\/ssrn\.(\d+)/,/ssrn\.com\/abstract/,/papers\.ssrn\.com\/sol3\//]}canHandleUrl(t){return/ssrn\.com\/(abstract|sol3|\d{7})/.test(t)||/papers\.ssrn\.com\/sol3\//.test(t)||/doi\.org\/10\.2139\/ssrn/.test(t)}extractPaperId(t){const e=t.match(/abstract[=_]?(\d+)/i);if(e)return e[1];const r=t.match(/abstract_id=(\d+)/i);if(r)return r[1];const n=t.match(/10\.2139\/ssrn\.(\d+)/);if(n)return n[1];const a=t.match(/ssrn\.com\/(\d{7,})/);return a?a[1]:null}createMetadataExtractor(t){return new B(t)}};e.getLogger("semanticscholar-integration");class z extends i{extractTitle(){return this.getMetaContent('meta[name="citation_title"]')||this.getMetaContent('meta[property="og:title"]')||super.extractTitle()}extractAuthors(){const t=[];return this.document.querySelectorAll('meta[name="citation_author"]').forEach(e=>{const r=e.getAttribute("content");r&&t.push(r)}),t.length>0?t.join(", "):super.extractAuthors()}extractDescription(){return this.getMetaContent('meta[name="description"]')||this.getMetaContent('meta[property="og:description"]')||super.extractDescription()}extractPublishedDate(){return this.getMetaContent('meta[name="citation_publication_date"]')||this.getMetaContent('meta[name="citation_date"]')||super.extractPublishedDate()}extractDoi(){return this.getMetaContent('meta[name="citation_doi"]')||super.extractDoi()}extractJournalName(){return this.getMetaContent('meta[name="citation_journal_title"]')||this.getMetaContent('meta[name="citation_conference_title"]')||super.extractJournalName()}extractTags(){const t=this.getMetaContent('meta[name="citation_keywords"]')||this.getMetaContent('meta[name="keywords"]');return t?t.split(/[;,]/).map(t=>t.trim()).filter(Boolean):super.extractTags()}}const F=new class extends l{constructor(){super(...arguments),this.id="semanticscholar",this.name="Semantic Scholar",this.urlPatterns=[/semanticscholar\.org\/paper\/[^/]+\/([a-f0-9]+)/,/semanticscholar\.org\/paper\/([a-f0-9]{40})/,/semanticscholar\.org\/paper\/[^?]*[?&]corpusId=(\d+)/,/semanticscholar\.org\/reader\/([a-f0-9]+)/,/semanticscholar\.org\/author\/[^/]+\/papers/,/semanticscholar\.org\/paper\//]}canHandleUrl(t){return/semanticscholar\.org\/(paper|reader)\//.test(t)}extractPaperId(t){const e=t.match(/\/([a-f0-9]{40})/);if(e)return e[1];const r=t.match(/[?&]corpusId=(\d+)/);if(r)return`corpus:${r[1]}`;const n=t.match(/semanticscholar\.org\/(?:paper|reader)\/[^/]*\/([a-f0-9]+)/);return n?n[1]:null}createMetadataExtractor(t){return new z(t)}};const R=new class extends l{constructor(){super(...arguments),this.id="url-misc",this.name="misc tracked url",this.urlPatterns=[/sciencedirect\.com\/science\/article\//,/philpapers\.org\/rec\//,/proceedings\.neurips\.cc\/paper_files\/paper\//,/papers\.nips\.cc\/paper_files\/paper\//,/journals\.sagepub\.com\/doi\//,/link\.springer\.com\/article\//,/science\.org\/doi\//,/journals\.aps\.org\/\w+\/abstract\//,/onlinelibrary\.wiley\.com\/doi\//,/physoc\.onlinelibrary\.wiley\.com\/doi\//,/cell\.com\/.*\/fulltext\//,/researchgate\.net\/publication\//,/psycnet\.apa\.org\/record\//,/biorxiv\.org\/content\//,/medrxiv\.org\/content\//,/osf\.io\/preprints\//,/frontiersin\.org\/journals?\//,/frontiersin\.org\/articles?\//,/jstor\.org\/stable\//,/proceedings\.mlr\.press\//,/journals\.plos\.org\/\w+\/article/,/ieeexplore\.ieee\.org\/document\//,/ieeexplore\.ieee\.org\/abstract\/document\//,/royalsocietypublishing\.org\/doi\//,/philarchive\.org\/archive\//,/tandfonline\.com\/doi\//,/iopscience\.iop\.org\/article\//,/academic\.oup\.com\/\w+\/article/,/elifesciences\.org\/articles\//,/escholarship\.org\/content\//,/pmc\.ncbi\.nlm\.nih\.gov\/articles\//,/ncbi\.nlm\.nih\.gov\/pmc\/articles\//,/pubmed\.ncbi\.nlm\.nih\.gov\/\d+/,/openaccess\.thecvf\.com\/content/,/zenodo\.org\/records?\//,/journals\.asm\.org\/doi\//,/bmj\.com\/content\//,/aclanthology\.org\/[A-Z0-9.-]+\//,/journals\.ametsoc\.org\/view\/journals\//,/substack\.com\/p\//,/citeseerx\.ist\.psu\.edu\//,/huggingface\.co\/papers\//,/paperswithcode\.com\/paper\//,/scholar\.google\.com\/scholar\?.*cluster=/,/papers\.ssrn\.com\/sol3\/papers\.cfm/,/ssrn\.com\/abstract=/,/cambridge\.org\/core\/journals\/.*\/article\//,/annualreviews\.org\/doi\//,/\/doi\/(?:abs|full|pdf|epdf)?\/?10\.\d+\//,/\.pdf(?:\?|$)/],this.contentScriptMatches=["sciencedirect.com/science/article/","philpapers.org/rec/","proceedings.neurips.cc/paper_files/paper/","journals.sagepub.com/doi/","link.springer.com/article/",".science.org/doi/","journals.aps.org/prx/abstract/","onlinelibrary.wiley.com/doi/","cell.com/trends/cognitive-sciences/fulltext/","researchgate.net/publication/","psycnet.apa.org/record/","biorxiv.org/content/","medrxiv.org/content/","osf.io/preprints/","frontiersin.org/journals/","frontiersin.org/articles/","jstor.org/stable/","proceedings.mlr.press/","journals.plos.org/plosone/article","ieeexplore.ieee.org/document/","royalsocietypublishing.org/doi/","papers.nips.cc/paper_files/paper/","philarchive.org/archive/","tandfonline.com/doi/","iopscience.iop.org/article/","academic.oup.com/brain/article/","elifesciences.org/articles/","escholarship.org/content/","pmc.ncbi.nlm.nih.gov/articles/","ncbi.nlm.nih.gov/pmc/articles/","pubmed.ncbi.nlm.nih.gov/","openaccess.thecvf.com/content/","zenodo.org/records/","journals.asm.org/doi/full/","physoc.onlinelibrary.wiley.com/doi/full/","storage.courtlistener.com/recap/","bmj.com/content/","ntsb.gov/investigations/pages","ntsb.gov/investigations/AccidentReports","aclanthology.org/","journals.ametsoc.org/view/journals/","huggingface.co/papers/","paperswithcode.com/paper/","papers.ssrn.com/","ssrn.com/abstract=","cambridge.org/core/journals/","annualreviews.org/doi/","substack.com/p/","citeseerx.","/doi/","/pdf/"]}canHandleUrl(t){return!!this.urlPatterns.some(e=>e.test(t))||this.contentScriptMatches.some(e=>t.includes(e))}},H=[p,g,f,b,M,_,A,D,S,k,E,$,q,J,Z,O,F,R],X=e.getLogger("content-script");X.info("Paper Tracker content script loaded");const W=new l;let K=null,V=null;let Y=!0,G=null;const Q=new class{constructor(t){this.patterns=[],this.observer=null,this.processedLinks=new Set,this.onLinkFound=t,r.debug("Link processor initialized")}registerPattern(t){this.patterns.push(t),r.debug(`Registered pattern for ${t.sourceId}`)}processLinks(t){t.querySelectorAll("a[href]").forEach(t=>{const e=this.getLinkId(t);if(!this.processedLinks.has(e)){this.processedLinks.add(e);for(const e of this.patterns)if(e.pattern.test(t.href)){const r=e.extractPaperId(t.href);if(r){this.onLinkFound(e.sourceId,r,t);break}}}})}startObserving(t){this.observer&&this.observer.disconnect(),this.observer=new MutationObserver(e=>{let r=!1;e.forEach(t=>{t.addedNodes.forEach(t=>{if(t.nodeType===Node.ELEMENT_NODE){"A"===t.tagName&&(r=!0);t.querySelectorAll("a[href]").length>0&&(r=!0)}})}),r&&this.processLinks(t)}),this.observer.observe(t.body,{childList:!0,subtree:!0}),r.debug("Started observing for DOM changes")}getLinkId(t){const e=this.getElementPath(t);return`${t.href}|${e}`}getElementPath(t){const e=[];let r=t;for(;r&&r!==document.body;){let t=r.tagName.toLowerCase();if(r.id)t+=`#${r.id}`;else{const e=Array.from(r.parentElement?.children||[]),n=e.indexOf(r)+1;e.length>1&&(t+=`:nth-child(${n})`)}e.unshift(t),r=r.parentElement}return e.join(" > ")}stopObserving(){this.observer&&(this.observer.disconnect(),this.observer=null,r.debug("Stopped observing DOM changes"))}}((t,e,r)=>{!function(t,e,r){if(t.nextSibling&&t.nextSibling.nodeType===Node.ELEMENT_NODE&&t.nextSibling.classList.contains("paper-annotator"))return;const n=document.createElement("span");n.className="paper-annotator",n.textContent="",n.title="Add annotation",n.dataset.sourceId=e,n.dataset.paperId=r,n.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),chrome.runtime.sendMessage({type:"showAnnotationPopup",sourceId:e,paperId:r,position:{x:t.clientX,y:t.clientY}})}),t.parentNode?.insertBefore(n,t.nextSibling)}(r,t,e)});function tt(t,e){et(),Y?(G={sourceId:t,paperId:e},chrome.runtime.sendMessage({type:"startSession",sourceId:t,paperId:e},r=>{r?.success?(X.debug(`Started session for ${t}:${e}`),function(){if(!G)return;et(),V=window.setInterval(()=>{G&&chrome.runtime.sendMessage({type:"sessionHeartbeat",sourceId:G.sourceId,paperId:G.paperId,timestamp:Date.now()})},5e3),X.debug(`Started heartbeat for ${G.sourceId}:${G.paperId}`)}()):X.error(`Failed to start session for ${t}:${e}`,r?.error)})):X.debug(`Not starting session for ${t}:${e} because tab is not visible`)}function et(){null!==V&&(clearInterval(V),V=null,X.debug("Stopped heartbeat"))}function rt(t){if(!G)return;const{sourceId:e,paperId:r}=G;et(),chrome.runtime.sendMessage({type:"endSession",sourceId:e,paperId:r,reason:t},n=>{X.debug(`Ended session for ${e}:${r}`,{reason:t})}),G=null}async function nt(t=!1){const e=window.location.href;let r=function(t){for(const e of H)if(e.canHandleUrl(t))return e;return null}(e);if(!r&&t&&(X.info(`No matching source found, but force parameter set. Using base source for: ${e}`),r=W),!r)return X.debug(`No source found for URL: ${e}`),null;const n=r.extractPaperId(e);if(!n)return X.info(`Unable to determine a paperId for url: ${e}`),null;try{const t=await r.extractMetadata(document,n);if(t)return chrome.runtime.sendMessage({type:"paperMetadata",metadata:t}),X.debug(`Sent extracted metadata to background script for ${t.sourceId}:${t.paperId}`),Y&&tt(t.sourceId,t.paperId),t}catch(t){X.error(`Error extracting metadata for ${r.id}:${n}`,t)}return null}document.addEventListener("click",t=>{!K||K.contains(t.target)||t.target.classList.contains("paper-annotator")||(K.parentElement?.remove(),K=null)}),document.addEventListener("visibilitychange",()=>{const t=Y;Y="visible"===document.visibilityState,Y&&!t?(X.info("Tab became visible again"),G?tt(G.sourceId,G.paperId):nt()):!Y&&t&&(X.info("Tab hidden"),G&&rt("tab_hidden"))}),window.addEventListener("focus",()=>{Y&&(X.info("Window gained focus"),G?tt(G.sourceId,G.paperId):nt())}),window.addEventListener("blur",()=>{X.info("Window lost focus"),G&&rt("window_blur")}),window.addEventListener("beforeunload",()=>{G&&(X.info("Page unloading"),rt("page_unload"))}),chrome.runtime.onMessage.addListener((t,e,r)=>{if(X.debug("Received message",t),"ping"===t.type)return r({success:!0,loaded:!0}),!0;if("extractPaperMetadata"===t.type)return X.debug("Received request to force paper metadata extraction"),nt(!0).then(t=>{r(t?{success:!0,metadata:t}:{success:!1,error:"Failed to extract metadata"})}).catch(t=>{X.error("Error extracting metadata",t),r({success:!1,error:t instanceof Error?t.message:"Unknown error"})}),!0;if("showPopup"===t.type){K&&(K.parentElement?.remove(),K=null);const e=document.createElement("div");e.className="paper-popup-wrapper",t.position&&(e.style.left=`${t.position.x}px`,e.style.top=`${t.position.y}px`);const n=document.createElement("div");if(n.className="paper-popup",n.innerHTML=t.html,e.appendChild(n),document.body.appendChild(e),t.handlers)for(const e of t.handlers){n.querySelectorAll(e.selector).forEach(r=>{r.addEventListener(e.event,()=>{chrome.runtime.sendMessage({type:"popupAction",action:e.action,sourceId:t.sourceId,paperId:t.paperId,data:{value:"TEXTAREA"===r.tagName?r.value:r.getAttribute("data-vote"),checked:"INPUT"===r.tagName?r.checked:void 0,id:r.id}})})})}return K=n,r({success:!0}),!0}return"processPage"===t.type?(Q.processLinks(document),nt(),r({success:!0}),!0):void 0}),async function(){!function(){if(document.getElementById("paper-tracker-styles"))return;const t=document.createElement("style");t.id="paper-tracker-styles",t.textContent="\n  .paper-annotator {\n    display: inline-block;\n    margin-left: 4px;\n    cursor: pointer;\n    font-size: 0.9em;\n    opacity: 0.7;\n    transition: opacity 0.2s;\n    vertical-align: baseline;\n  }\n\n  .paper-annotator:hover {\n    opacity: 1;\n  }\n\n  .paper-popup-wrapper {\n    position: fixed;\n    z-index: 10000;\n  }\n\n  .paper-popup {\n    position: relative;\n    background: white;\n    border: 1px solid #ddd;\n    border-radius: 6px;\n    padding: 12px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n    width: 300px;\n    box-sizing: border-box;\n  }\n\n  .paper-popup-header {\n    font-weight: bold;\n    margin-bottom: 8px;\n    line-height: 1.4;\n    font-size: 1em;\n  }\n\n  .paper-popup-meta {\n    color: #666;\n    font-size: 0.85em;\n    margin-bottom: 12px;\n    line-height: 1.4;\n  }\n\n  .paper-popup-buttons {\n    display: flex;\n    gap: 8px;\n    margin: 8px 0;\n  }\n\n  .paper-popup button {\n    padding: 6px 12px;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    background: #f5f5f5;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    font-size: 0.9em;\n  }\n\n  .paper-popup button:hover {\n    background: #e8e8e8;\n    border-color: #ccc;\n  }\n\n  .paper-popup button.active {\n    background: #e0e0e0;\n    border-color: #aaa;\n  }\n\n  .paper-popup textarea {\n    width: calc(100% - 16px);\n    min-height: 80px;\n    margin: 8px 0;\n    padding: 8px;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    resize: vertical;\n    font-family: inherit;\n    font-size: 0.9em;\n    line-height: 1.4;\n    box-sizing: border-box;\n  }\n\n  .paper-popup textarea:focus {\n    outline: none;\n    border-color: #aaa;\n  }\n\n  .paper-popup-actions {\n    display: flex;\n    justify-content: flex-end;\n    gap: 8px;\n    margin-top: 12px;\n  }\n\n  .paper-popup .save-button {\n    background: #2563eb;\n    color: white;\n    border-color: #2563eb;\n  }\n\n  .paper-popup .save-button:hover {\n    background: #1d4ed8;\n    border-color: #1d4ed8;\n  }\n  ",document.head.appendChild(t),X.debug("Injected styles")}(),function(){for(const t of H)X.debug(`Initializing source: ${t.id}`),t.urlPatterns.forEach(e=>{Q.registerPattern({sourceId:t.id,pattern:e,extractPaperId:e=>t.extractPaperId(e)})})}(),Q.processLinks(document),Q.startObserving(document),Y="visible"===document.visibilityState,nt(),chrome.runtime.sendMessage({type:"contentScriptReady",url:window.location.href},t=>{t?.success&&X.debug("Background script acknowledged ready status")})}();let at=location.href;new MutationObserver(()=>{const t=location.href;t!==at&&(G&&rt("url_change"),at=t,nt())}).observe(document,{subtree:!0,childList:!0})}();
//# sourceMappingURL=content-script.js.map
