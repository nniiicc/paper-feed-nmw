{"version":3,"file":"popup.bundle.js","sources":["../../utils/browser-api.ts","../../popup.ts"],"sourcesContent":["// utils/browser-api.ts\n// Cross-browser API abstraction for Chrome and Firefox compatibility\n\n/**\n * Cross-browser extension API\n *\n * Firefox uses the `browser` namespace with Promise-based APIs\n * Chrome uses the `chrome` namespace (now also supports Promises in MV3)\n *\n * This abstraction provides a unified interface that works in both browsers.\n */\n\n// Declare browser global for Firefox\ndeclare const browser: typeof chrome | undefined;\n\n// Use browser namespace if available (Firefox), otherwise fall back to chrome (Chrome/Edge)\nconst browserAPI: typeof chrome = typeof browser !== 'undefined' ? browser : chrome;\n\nexport { browserAPI as browser };\n","// extension/popup.ts\n// Popup script with refactored manual paper tracking\n\nimport { PaperMetadata } from './papers/types';\nimport { browser } from './utils/browser-api';\n\nconsole.log('Popup script starting...');\n\n// Function to get paper data from background script\nasync function getCurrentPaper(): Promise<PaperMetadata | null> {\n  return new Promise((resolve) => {\n    browser.runtime.sendMessage({type: 'getCurrentPaper'}, (response) => {\n      console.log('Got paper data from background:', response);\n      resolve(response as PaperMetadata | null);\n    });\n  });\n}\n\n// Interface for message response\ninterface MessageResponse {\n  success: boolean;\n  error?: string;\n  metadata?: PaperMetadata;\n}\n\n// Function to update UI with paper data\nfunction updateUI(paperData: PaperMetadata | null): void {\n  const titleElement = document.getElementById('paperTitle');\n  const authorsElement = document.getElementById('paperAuthors');\n  const statusElement = document.getElementById('status');\n  const manualLogSection = document.getElementById('manualLogSection');\n\n  if (!titleElement || !authorsElement || !statusElement || !manualLogSection) {\n    console.error('Required DOM elements not found');\n    return;\n  }\n\n  if (paperData) {\n    // Show detected paper data\n    titleElement.textContent = paperData.title || paperData.paperId;\n    authorsElement.textContent = paperData.authors;\n    statusElement.textContent = 'Paper tracked! Issue created on GitHub.';\n    \n    // Enable rating buttons\n    const thumbsUpButton = document.getElementById('thumbsUp') as HTMLButtonElement;\n    const thumbsDownButton = document.getElementById('thumbsDown') as HTMLButtonElement;\n    \n    if (thumbsUpButton && thumbsDownButton) {\n      thumbsUpButton.disabled = false;\n      thumbsDownButton.disabled = false;\n      \n      // Set active state on rating buttons\n      thumbsUpButton.classList.toggle('active', paperData.rating === 'thumbsup');\n      thumbsDownButton.classList.toggle('active', paperData.rating === 'thumbsdown');\n    }\n    \n    // Hide manual log section\n    manualLogSection.style.display = 'none';\n  } else {\n    // No paper detected - show manual log option\n    titleElement.textContent = 'No paper detected';\n    authorsElement.textContent = '';\n    statusElement.textContent = 'Current page not recognized as a paper';\n    \n    // Disable rating buttons\n    const thumbsUpButton = document.getElementById('thumbsUp') as HTMLButtonElement;\n    const thumbsDownButton = document.getElementById('thumbsDown') as HTMLButtonElement;\n    \n    if (thumbsUpButton && thumbsDownButton) {\n      thumbsUpButton.disabled = true;\n      thumbsDownButton.disabled = true;\n    }\n    \n    // Show manual log section\n    manualLogSection.style.display = 'block';\n  }\n}\n\n// Function to ensure content script is loaded\nasync function ensureContentScriptLoaded(tabId: number): Promise<boolean> {\n  try {\n    // Try to ping the content script\n    return new Promise((resolve) => {\n      browser.tabs.sendMessage(tabId, { type: 'ping' }, (response) => {\n        if (browser.runtime.lastError) {\n          // Content script not loaded, try to inject it\n          console.log('Content script not loaded, injecting...');\n          browser.scripting.executeScript({\n            target: { tabId },\n            files: ['dist/content-script.js']\n          }).then(() => {\n            console.log('Content script injected successfully');\n            // Wait a bit for the script to initialize\n            setTimeout(() => resolve(true), 500);\n          }).catch((err) => {\n            console.error('Failed to inject content script:', err);\n            resolve(false);\n          });\n        } else {\n          // Content script is already loaded\n          resolve(true);\n        }\n      });\n    });\n  } catch (err) {\n    console.error('Error ensuring content script:', err);\n    return false;\n  }\n}\n\n// Function to log current page as a paper (using content script extraction)\nasync function logCurrentPage(): Promise<void> {\n  console.log(\"attempting to log paper\");\n\n  // Get the active tab\n  const tabs = await browser.tabs.query({ active: true, currentWindow: true });\n  if (!tabs[0] || !tabs[0].id) {\n    const statusElement = document.getElementById('status');\n    if (statusElement) {\n      statusElement.textContent = 'Error: Could not access current tab';\n    }\n    return;\n  }\n\n  const tabId = tabs[0].id;\n  const tabUrl = tabs[0].url || '';\n\n  // Check if this is a special page we can't access\n  if (tabUrl.startsWith('chrome://') || tabUrl.startsWith('chrome-extension://') ||\n      tabUrl.startsWith('about:') || tabUrl.startsWith('edge://') ||\n      tabUrl.startsWith('moz-extension://')) {\n    const statusElement = document.getElementById('status');\n    if (statusElement) {\n      statusElement.textContent = 'Error: Cannot access this type of page';\n    }\n    return;\n  }\n\n  // Show loading state\n  const statusElement = document.getElementById('status');\n  if (statusElement) {\n    statusElement.textContent = 'Extracting paper metadata...';\n  }\n\n  // Ensure content script is loaded\n  const contentScriptLoaded = await ensureContentScriptLoaded(tabId);\n  if (!contentScriptLoaded) {\n    if (statusElement) {\n      statusElement.textContent = 'Error: Could not load content script on this page';\n    }\n    return;\n  }\n\n  // Send message to content script requesting extraction\n  browser.tabs.sendMessage(tabId, {\n    type: 'extractPaperMetadata'\n  }, (response: MessageResponse) => {\n    if (browser.runtime.lastError) {\n      // Handle error\n      if (statusElement) {\n        statusElement.textContent = 'Error: ' + browser.runtime.lastError.message;\n      }\n      return;\n    }\n\n    if (!response || !response.success || !response.metadata) {\n      // Handle extraction failure\n      if (statusElement) {\n        statusElement.textContent = 'Error: ' + (response?.error || 'Failed to extract metadata');\n      }\n      return;\n    }\n\n    // Metadata extracted, now explicitly send to background to store in GitHub\n    browser.runtime.sendMessage({\n      type: 'manualPaperLog',\n      metadata: response.metadata\n    }, (storeResponse: MessageResponse) => {\n      if (storeResponse && storeResponse.success) {\n        // Success - update UI\n        updateUI(response.metadata!);\n        if (statusElement) {\n          statusElement.textContent = 'Paper tracked and saved to GitHub!';\n        }\n      } else {\n        // GitHub storage failed but we still have the metadata\n        updateUI(response.metadata!);\n        if (statusElement) {\n          const errorMsg = storeResponse?.error || 'Could not save to GitHub';\n          statusElement.textContent = 'Paper detected but: ' + errorMsg;\n          statusElement.style.color = '#d97706'; // Warning color\n        }\n      }\n    });\n\n    // Hide manual log section\n    const manualLogSection = document.getElementById('manualLogSection');\n    if (manualLogSection) {\n      manualLogSection.style.display = 'none';\n    }\n\n    // Enable rating buttons\n    const thumbsUpButton = document.getElementById('thumbsUp') as HTMLButtonElement;\n    const thumbsDownButton = document.getElementById('thumbsDown') as HTMLButtonElement;\n    if (thumbsUpButton && thumbsDownButton) {\n      thumbsUpButton.disabled = false;\n      thumbsDownButton.disabled = false;\n    }\n  });\n}\n\n// Initialize popup\ndocument.addEventListener('DOMContentLoaded', async () => {\n  console.log('Popup opened');\n  \n  // Get paper from the session tracker\n  let paperData: PaperMetadata | null = null;\n  let retries = 3;\n  \n  while (retries > 0 && !paperData) {\n    paperData = await getCurrentPaper();\n    if (!paperData) {\n      await new Promise(resolve => setTimeout(resolve, 500)); // Wait 500ms before retry\n      retries--;\n    }\n  }\n  \n  updateUI(paperData);\n  \n  // Set up rating handlers\n  const thumbsUpButton = document.getElementById('thumbsUp');\n  if (thumbsUpButton) {\n    thumbsUpButton.addEventListener('click', () => {\n      browser.runtime.sendMessage({\n        type: 'updateRating',\n        rating: 'thumbsup'\n      }, (response: MessageResponse) => {\n        const statusElement = document.getElementById('status');\n        const thumbsUpButton = document.getElementById('thumbsUp');\n        const thumbsDownButton = document.getElementById('thumbsDown');\n        \n        if (!statusElement || !thumbsUpButton || !thumbsDownButton) return;\n        \n        if (response && response.success) {\n          statusElement.textContent = 'Rating updated to: thumbs up';\n          thumbsUpButton.classList.add('active');\n          thumbsDownButton.classList.remove('active');\n          setTimeout(() => window.close(), 1500);\n        } else {\n          statusElement.textContent = 'Error: ' + (response?.error || 'Unknown error');\n        }\n      });\n    });\n  }\n  \n  const thumbsDownButton = document.getElementById('thumbsDown');\n  if (thumbsDownButton) {\n    thumbsDownButton.addEventListener('click', () => {\n      browser.runtime.sendMessage({\n        type: 'updateRating',\n        rating: 'thumbsdown'\n      }, (response: MessageResponse) => {\n        const statusElement = document.getElementById('status');\n        const thumbsUpButton = document.getElementById('thumbsUp');\n        const thumbsDownButton = document.getElementById('thumbsDown');\n        \n        if (!statusElement || !thumbsUpButton || !thumbsDownButton) return;\n        \n        if (response && response.success) {\n          statusElement.textContent = 'Rating updated to: thumbs down';\n          thumbsDownButton.classList.add('active');\n          thumbsUpButton.classList.remove('active');\n          setTimeout(() => window.close(), 1500);\n        } else {\n          statusElement.textContent = 'Error: ' + (response?.error || 'Unknown error');\n        }\n      });\n    });\n  }\n  \n  // Set up one-click logging button\n  const logPageButton = document.getElementById('logPageButton');\n  if (logPageButton) {\n    console.log(\"Attaching logPageButton event listener...\");\n    logPageButton.addEventListener('click', () => {\n      console.log(\"logPageButton clicked...\");\n      logCurrentPage();\n    });\n  }\n});\n"],"names":["browser"],"mappings":"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"}